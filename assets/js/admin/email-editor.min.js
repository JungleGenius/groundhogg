var wpghEmailEditor;!function($){$.fn.wpghToolBar=function(){return this.each(function(){var i=$(this);0===i.find("wpgh-toolbar").length&&i.prepend('<wpgh-toolbar class="action-icons"><div><span class="dashicons dashicons-admin-page"></span><span class="dashicons dashicons-move handle"></span><span class="dashicons dashicons-trash"></span></div></wpgh-toolbar>')}),this}}(jQuery),function($,i){wpghEmailEditor={editor:null,actions:null,active:null,alignment:null,sidebar:null,htmlCode:null,init:function(){this.editor=$("#email-body"),this.actions=$("#editor-actions"),this.editor.on("click",function(i){i.preventDefault(),wpghEmailEditor.feed(i.target)}),this.editor.on("click","span.dashicons-admin-page",function(i){i.preventDefault(),wpghEmailEditor.duplicateBlock(i.target)}),this.editor.on("click","span.dashicons-trash",function(i){i.preventDefault(),wpghEmailEditor.deleteBlock(i.target)}),this.makeSortable(),this.makeDraggable(),$("form").on("submit",function(i){wpghEmailEditor.save(i)}),this.sidebar=new StickySidebar(".editor-actions-inner",{topSpacing:32,bottomSpacing:0}),$(".row").wpghToolBar(),this.alignment=$("#email-align"),this.alignment.on("change",function(){var i=$("#email-inside");"left"===$(this).val()?(i.css("margin-left","0"),i.css("margin-right","auto")):(i.css("margin-left","auto"),i.css("margin-right","auto"))}),this.inFrame()&&($("html").css("padding-top",0),$("#wpcontent").css("margin",0),$("#wpadminbar").addClass("hidden"),$("#adminmenuwrap").addClass("hidden"),$("#adminmenuback").addClass("hidden"),$("#wpfooter").addClass("hidden"),$(".title-wrap").css("display","none"),$(".funnel-editor-header").css("top",0),$(parent.document).on("click",".popup-save",function(i){wpghEmailEditor.save(i)}),parent.wpghEmailElement.ID=email.id),this.editorSizing(),$(window).resize(function(){wpghEmailEditor.editorSizing()}),$("#editor-toggle").change(function(){$(this).is(":checked")?(wpghEmailEditor.htmlCode||wpghEmailEditor.initCodeMirror(),$("#email-content").hide(),$("#html-editor").show(),wpghEmailEditor.prepareEmailHTML(),wpghEmailEditor.htmlCode.doc.setValue(html_beautify($("#email-inside").html()))):($(".row").wpghToolBar(),$("#html-editor").hide(),$("#email-content").show())}).change()},prepareEmailHTML:function(){var i=$("#email-content");$("wpgh-toolbar").remove(),i.find("div").removeAttr("contenteditable").removeClass("active"),wpghTextBlock.destroyEditor()},initCodeMirror:function(){this.htmlCode=CodeMirror.fromTextArea(document.getElementById("html-code"),{lineNumbers:!0,mode:"text/html",matchBrackets:!0,indentUnit:4,specialChars:/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b-\u200f\u2028\u2029\ufeff]/}),this.htmlCode.on("change",function(){$("#email-inside").html(wpghEmailEditor.htmlCode.doc.getValue())}),this.htmlCode.setSize(null,this.editor.height())},inFrame:function(){try{return window.self!==window.top}catch(i){return!0}},save:function(i){i.preventDefault(),$(".spinner").css("visibility","visible"),this.prepareEmailHTML(),$("#content").val($("#email-inside").html());var t=$("form").serialize();t+="&action=gh_update_email";$.ajax({type:"post",url:ajaxurl,dataType:"json",data:t,success:function(i){console.log(i),$("#notices").html(i.notices),$(".spinner").css("visibility","hidden"),$(".row").wpghToolBar(),wpghEmailEditor.makeDismissible()}})},makeDismissible:function(){$("<button type='button' class='notice-dismiss'><span class='screen-reader-text'>Dismiss This Notice</span></button>").appendTo(".is-dismissible"),$(".notice-dismiss").on("click",function(i){$(this).parent().fadeOut(500,function(){$(this).remove()})})},editorSizing:function(){$(".funnel-editor-header").width($("#poststuff").width()),$("#email-body").height($("#postbox-container-1").height()-87)},makeSortable:function(){$(".email-sortable").sortable({placeholder:"sortable-placeholder",axis:"y",start:function(i,t){t.placeholder.height(t.item.height())},handle:".handle",stop:function(i,t){}})},makeDraggable:function(){$(".email-draggable").draggable({connectToSortable:".email-sortable",helper:"clone",start:function(i,t){var e=this.id.replace("-block",""),a=$("."+e+"-template").children().first().clone();$("#temp-html").html(a)},stop:function(i,t){$("#email-content").find(".email-draggable").replaceWith($("#temp-html").html())}})},feed:function(i){if(null!==i.parentNode){var t=$(i).closest(".row");if(!t.hasClass("active")){if(!t.hasClass("row"))return this.editor.find(".row").removeClass("active"),this.actions.find(".postbox").addClass("hidden"),this.actions.find("#email-editor").removeClass("hidden"),void $(document).trigger("madeInactive");this.active=t,this.editor.find(".row").removeClass("active"),t.addClass("active");var e=t.attr("data-block");if(void 0===e&&void 0!==t){var a=t.find(".content-wrapper").attr("class");e=(e=/\w+_block/.exec(a)[0]).replace("_block","")}this.actions.find(".postbox").addClass("hidden"),this.actions.find("#"+e+"-block-editor").removeClass("hidden"),$(document).trigger("madeActive",[t,e]),this.sidebar.updateSticky()}}},deleteBlock:function(i){$(i).closest(".row").remove()},duplicateBlock:function(i){$(document).trigger("duplicateBlock"),$(i).closest(".row").removeClass("active"),$(i).closest(".row").clone().insertAfter($(i).closest(".row"))},getActive:function(){return this.active}},$(function(){wpghEmailEditor.init()})}(jQuery);