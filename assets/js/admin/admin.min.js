(function($,nonces,endpoints,gh){$.fn.serializeFormJSON=function(){var o={};var a=this.serializeArray();$.each(a,function(){if(o[this.name]){if(!o[this.name].push){o[this.name]=[o[this.name]]}o[this.name].push(this.value||"")}else{o[this.name]=this.value||""}});return o};function picker(selector,args){return $(selector).select2(args)}function apiPicker(selector,endpoint,multiple,tags,getResults,params){multiple=multiple||false;tags=tags||false;getResults=getResults||function(data){return data.results};params=params||function(params){return params};return $(selector).select2({tags:tags,multiple:multiple,tokenSeparators:["/",",",";"],ajax:{url:endpoint,delay:250,dataType:"json",data:params,beforeSend:function(xhr){xhr.setRequestHeader("X-WP-Nonce",nonces._wprest)},processResults:function(data,page){return{results:getResults(data,page)}}}})}function linkPicker(selector){return $(selector).autocomplete({source:function(request,response){$.ajax({url:ajaxurl,method:"post",dataType:"json",data:{action:"wp-link-ajax",_ajax_linking_nonce:nonces._ajax_linking_nonce,term:request.term},success:function(data){var $return=[];for(var item in data){if(data.hasOwnProperty(item)){item=data[item];$return.push({label:item.title+" ("+item.info+")",value:item.permalink})}}response($return)}})},minLength:0})}function metaPicker(selector){return $(selector).autocomplete({source:function(request,response){$.ajax({url:ajaxurl,method:"post",dataType:"json",data:{action:"gh_meta_picker",nonce:nonces._meta_nonce,term:request.term},success:function(data){response(data);$(selector).removeClass("ui-autocomplete-loading")}})},minLength:0})}function tagPicker(selector,multiple=true){return apiPicker(selector,gh.api.routes.v4.tags,multiple,true,data=>{return data.items.map(item=>{return{id:item.ID,text:`${item.data.tag_name}`}})},query=>{return{search:query.term}})}function emailPicker(selector,multiple=false){return apiPicker(selector,gh.api.routes.v4.emails,multiple,true,data=>{return data.items.map(item=>{return{id:item.ID,text:`${item.data.title} (${item.data.status})`}})},query=>{return{search:query.term}})}function buildPickers(){picker(".gh-select2",{});tagPicker(".gh-tag-picker",true);tagPicker(".gh-single-tag-picker",false);emailPicker(".gh-email-picker",false);emailPicker(".gh-email-picker-multiple",true);apiPicker(".gh-sms-picker",endpoints.sms,false,false);apiPicker(".gh-contact-picker",endpoints.contacts,false,false);apiPicker(".gh-contact-picker-multiple",endpoints.contacts,true,false);apiPicker(".gh-benchmark-picker",endpoints.benchmarks,false,false);apiPicker(".gh-metakey-picker",endpoints.metakeys,false,false);linkPicker(".gh-link-picker");metaPicker(".gh-meta-picker")}$(function(){buildPickers()});$(document).on("new-step gh-init-pickers",function(){buildPickers()});$(document).on("click",".dropdown-button .button.dropdown",function(){var $button=$(this);$button.next().toggleClass("show");$("<div class='dropdown-overlay'></div>").insertAfter($button)});$(document).on("click",".dropdown-button .dropdown-overlay",function(){var $overlay=$(this);$overlay.next().toggleClass("show");$overlay.remove()});gh.pickers={picker:picker,tagPicker:tagPicker,emailPicker:emailPicker,apiPicker:apiPicker,linkPicker:linkPicker,metaPicker:metaPicker};gh.nonces=nonces;gh.endpoints=endpoints})(jQuery,groundhogg_nonces,groundhogg_endpoints,Groundhogg);