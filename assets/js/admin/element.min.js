(function($){Object.filter=function(obj,predicate){let result={},key;for(key in obj){if(obj.hasOwnProperty(key)&&predicate(key,obj[key])){result[key]=obj[key]}}return result};function improveTinyMCE(){if(typeof this.flag!=="undefined"){return}$(document).on("tinymce-editor-setup",function(event,editor){editor.settings.toolbar1="formatselect,bold,italic,bullist,numlist,blockquote,alignleft,aligncenter,alignright,link,spellchecker,wp_adv,dfw,groundhoggreplacementbtn,groundhoggemojibtn";editor.settings.toolbar2="strikethrough,hr,forecolor,pastetext,removeformat,charmap,outdent,indent,undo,redo,wp_help";editor.settings.height=200;editor.on("click",function(ed,e){$(document).trigger("to_mce")})})}function copyObject(object,initial){initial=initial||{};return $.extend(true,initial,object)}function andList(array,text="and"){if(array.length===1){return array[0]}return`${array.slice(0,-1).join(", ")} ${text} ${array[array.length-1]}`}function orList(array){return andList(array,"or")}const createSlotFillProvider=()=>({fills:[],_slotsMounted:[],_slotsDemounted:[],slot:function(slotName,...args){this._slotsMounted.push({name:slotName,args:args});return this.fills.filter(fill=>fill.slot===slotName).map(fill=>fill.render(...args)).join("")},slotsMounted:function(){let slot;while(this._slotsMounted.length>0){slot=this._slotsMounted.pop();this.fills.filter(fill=>fill.slot===slot.name).forEach(fill=>{fill.onMount(...slot.args)});this._slotsDemounted.push(slot)}},slotsDemounted:function(){let slot;while(this._slotsDemounted.length>0){slot=this._slotsDemounted.pop();this.fills.filter(fill=>fill.slot===slot.name).forEach(fill=>{fill.onDemount(...slot.args)})}},fill:function(slot,component){this.fills.push({slot:slot,...{render:function(){},onMount:function(){},onDemount:function(){},...component}})}});function isString(string){return typeof string==="string"}const specialChars=string=>{if(!isString(string)){return string}return string.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")};const kebabize=str=>{return str.split("").map((letter,idx)=>{return letter.toUpperCase()===letter?`${idx!==0?"-":""}${letter.toLowerCase()}`:letter}).join("")};const objectToStyle=object=>{const props=[];for(const prop in object){if(object.hasOwnProperty(prop)){props.push(`${kebabize(prop)}:${specialChars(object[prop])}`)}}return props.join(";")};function uuid(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,c=>(c^crypto.getRandomValues(new Uint8Array(1))[0]&15>>c/4).toString(16))}const objectToProps=object=>{const props=[];for(const prop in object){if(object.hasOwnProperty(prop)&&typeof object[prop]!=="undefined"&&object[prop]!==false){switch(prop){case"className":props.push(`class="${specialChars(object[prop])}"`);break;case"style":props.push(`style="${specialChars(objectToStyle(object[prop]))}"`);break;default:props.push(`${kebabize(prop)}="${specialChars(object[prop])}"`);break}}}return props.join(" ")};const Elements={toggle:function({id:id,name:name,className:className,value:value="1",onLabel:onLabel="on",offLabel:offLabel="off",checked:checked}){return`
		  <label class="gh-switch ${className}">
			  <input id="${id}" name="${name}" value="${value}" type="checkbox" ${checked?"checked":""}>
			  <span class="slider round"></span>
			  <span class="on">${onLabel}</span>
			  <span class="off">${offLabel}</span>
		  </label>`},input:function(props){props={type:"text",className:"input regular-text",...props};return`<input ${objectToProps(props)}/>`},select:function(props,options,selected){return`<select ${objectToProps(props)}>${createOptions(options,selected)}</select>`},option:function(value,text,selected){return`
		  <option value="${specialChars(value)}" ${selected?"selected":""}>${text}</option>`},mappableFields:function(props,selected){return Elements.select(props,Groundhogg.fields.mappable,selected)},textarea:function(props){return`<textarea ${objectToProps(Object.filter(props,key=>key!=="value"))}>${specialChars(props.value)}</textarea>`},inputWithReplacementsAndEmojis:function(inputProps={type:"text"},replacements=true,emojis=true){const classList=[replacements&&"input-with-replacements",emojis&&"input-with-emojis"];return`
		  <div class="input-wrap ${classList.filter(c=>c).join(" ")}">
			  ${Elements.input(inputProps)}
			  ${emojis?`<button class="emoji-picker-start" title="insert emoji"><span class="dashicons dashicons-smiley"></span>
			  </button>`:""}
			  ${replacements?`<button class="replacements-picker-start" title="insert replacement"><span
				  class="dashicons dashicons-admin-users"></span></button>`:""}
		  </div>`},inputWithReplacements:function(atts){return Elements.inputWithReplacementsAndEmojis(atts,true,false)},inputWithEmojis:function(atts){return Elements.inputWithReplacementsAndEmojis(atts,false,true)},textAreaWithReplacementsAndEmojis:function({name:name,id:id,value:value,className:className,placeholder:placeholder=""},replacements=true,emojis=true){const classList=[replacements&&"input-with-replacements",emojis&&"input-with-emojis"];return`
		  <div class="input-wrap ${classList.filter(c=>c).join(" ")}" xmlns="http://www.w3.org/1999/html">
			  <textarea id="${id}" name="${name}" class="${className}"
	              placeholder="${specialChars(placeholder)}">${specialChars(value)||""}</textarea>
			  <div class="buttons">
				  ${replacements?`<button class="replacements-picker-start" title="insert replacement"><span
				  class="dashicons dashicons-admin-users"></span></button>`:""}
				  ${emojis?`<button class="emoji-picker-start" title="insert emoji"><span class="dashicons dashicons-smiley"></span>
			  </button>`:""}
			  </div>
		  </div>`},textAreaWithReplacements:function(atts){return Elements.textAreaWithReplacementsAndEmojis(atts,true,false)},textAreaWithEmojis:function(atts){return Elements.textAreaWithReplacementsAndEmojis(atts,false,true)}};var codeMirror;var codeMirrorIsFocused;var $doc=$(document);$doc.on("ghInsertReplacement",function(e,insert){if(codeMirrorIsFocused){codeMirror.doc.replaceSelection(insert)}});$doc.on("ghReplacementTargetChanged",function(){codeMirrorIsFocused=false});const codeEditor=({selector:selector="",onChange:onChange=content=>{},initialContent:initialContent="",height:height=500})=>{var editorSettings=wp.codeEditor.defaultSettings?_.clone(wp.codeEditor.defaultSettings):{};editorSettings.codemirror=_.extend({},editorSettings.codemirror,{indentUnit:4,tabSize:4});codeMirror=wp.codeEditor.initialize($(selector),editorSettings).codemirror;codeMirror.on("change",function(){onChange(codeMirror.doc.getValue())});codeMirror.on("focus",function(){codeMirrorIsFocused=true;$doc.trigger("ghClearReplacementTarget")});codeMirror.doc.setValue(html_beautify(initialContent,{indent_with_tabs:true}));codeMirror.setSize(null,height);return{editor:codeMirror}};const tinymceElement=(editor_id,config={},onChange=v=>{console.log(v)})=>{wp.editor.initialize(editor_id,{tinymce:true,quicktags:true,...config});tinymce.get(editor_id).on("keyup",function(e){onChange(tinyMCE.activeEditor.getContent({format:"raw"}),tinyMCE.activeEditor.getContent({format:"raw"}))})};const loadingModal=()=>{let stop=()=>{};return modal({content:"<h1>Loading</h1>",canClose:false,onOpen:()=>{stop=loadingDots(".gh-modal h1").stop},onClose:()=>{stop()}})};const savingModal=()=>{let stop=()=>{};return modal({content:"<h1>Saving</h1>",canClose:false,onOpen:()=>{stop=loadingDots(".gh-modal h1").stop},onClose:()=>{stop()}})};const confirmationModal=({alert:alert="",confirmText:confirmText="Confirm",closeText:closeText="Cancel",onConfirm:onConfirm=()=>{},onClose:onClose=()=>{}})=>{const content=`
		<button type="button" class="dashicon-button gh-modal-button-close-top gh-modal-button-close">
			<span class="dashicons dashicons-no-alt"></span>
		</button>
		<div class="gh-modal-dialog-alert">
			${alert}
		</div>
		<div class="gh-modal-confirmation-buttons gh-button-group">
			<button type="button" class="gh-button danger gh-modal-button-close">${closeText}</button>
			<button type="button" class="gh-button primary gh-modal-button-confirm">${confirmText}</button>
		</div>`;const{close:close,$modal:$modal}=modal({content:content,onClose:onClose});const confirm=()=>{onConfirm();close()};const handleConfirm=()=>{confirm()};$(".gh-modal-button-confirm").on("click",handleConfirm);return{close:close,confirm:confirm,$modal:$modal}};const modal=({content:content="",onClose:onClose=()=>{},canClose:canClose=true,onOpen:onOpen=()=>{}})=>{const html=`
		<div class="gh-modal">
			<div class="gh-modal-overlay"></div>
			<div class="gh-modal-dialog">
				${canClose?`	<button type="button" class="dashicon-button gh-modal-button-close-top gh-modal-button-close">
					<span class="dashicons dashicons-no-alt"></span>
				</button>`:""}
				<div class="gh-modal-dialog-content">
					${content}
				</div>
			</div>
		</div>`;const $modal=$(html);const close=()=>{$modal.remove();onClose()};const handleClose=()=>{close()};const setContent=content=>{$modal.find(".gh-modal-dialog-content").html(content)};$("body").append($modal);onOpen();if(canClose){$(".gh-modal-overlay, .gh-modal-button-close").on("click",handleClose)}return{$modal:$modal,close:close,setContent:setContent}};const loadingDots=selector=>{const $el=$('<span class="loading-dots"></span>');$(selector).append($el);const stop=()=>{clearInterval(interval)};const interval=setInterval(()=>{if($el.html().length>=3){$el.html(".")}else{$el.html($el.html()+".")}},500);return{stop:stop}};const createOptions=(options,selected)=>{const optionsString=[];if(Array.isArray(options)){options.forEach(option=>{optionsString.push(Elements.option(option.value,option.text,Array.isArray(selected)?selected.indexOf(option.value)!==-1:option.value===selected))})}else{for(const option in options){if(options.hasOwnProperty(option)){optionsString.push(Elements.option(option,options[option],Array.isArray(selected)?selected.indexOf(option)!==-1:option===selected))}}}return optionsString.join("")};const regexp=str=>{return new RegExp(str,"i")};if(!Element.prototype.matches){Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(s){var matches=(this.document||this.ownerDocument).querySelectorAll(s),i=matches.length;while(--i>=0&&matches.item(i)!==this){}return i>-1}}function clickInsideElement(e,selector){var el=e.srcElement||e.target;if(el&&el.matches(selector)){return el}else{while(el=el.parentNode){if(typeof el.matches!=="undefined"&&el.matches(selector)){return el}}}return false}const searchOptionsWidget=({selector:selector,options:options=[],groups:groups={},filterOption:filterOption=(option,search)=>option.match(regexp(search)),renderOption:renderOption=option=>option,noOptions:noOptions=`No options...`,onSelect:onSelect=option=>console.log(option),onClose:onClose=()=>{},onOpen:onOpen=()=>{}})=>({selector:selector,options:options,filterOption:filterOption,renderOption:renderOption,onClose:onClose,onSelect:onSelect,groups:groups,search:"",focusedOptionId:0,previousFocusedOptionId:false,focusedOption:false,render:function(){return`
		  <div class="search-options-widget-wrap">
			  <div class="search-options-widget" tabindex="0">
				  <div class="header">
					  ${Elements.input({name:"search",type:"search",className:"search-for-options",autocomplete:"off",placeholder:"Search..."})}
					  <button class="close">
						  <span class="dashicons dashicons-no-alt"></span>
					  </button>
				  </div>
				  <div class="search-options ${this.hasGroups()?"has-groups":"no-groups"}"></div>
			  </div>
		  </div>`},getOptions:function(){return options.filter((option,i)=>{if(this.search){return filterOption(option,this.search)}return true})},hasGroups:function(){return Object.keys(groups).length>0},renderSearchOptions:function(){const searchOptions=[];let focusedIndex=0;var self=this;const optionDiv=(option,group,id,index)=>{return`<div class="option ${index===this.focusedOptionId?"focused":""}" data-option="${id}" data-group="${group}">${renderOption(option)}</div>`};if(Object.keys(groups).length>0){Object.keys(groups).forEach((group,g)=>{const options=[];this.getOptions().filter(option=>option.group===group).forEach((option,o)=>{options.push(optionDiv(option,group,o,focusedIndex));focusedIndex++});if(options.length>0){searchOptions.push(`<div class="option-group" data-group="${group}">${groups[group]}</div>`,...options)}})}else{this.getOptions().forEach((option,o)=>{searchOptions.push(optionDiv(option,null,o,focusedIndex));focusedIndex++})}return searchOptions.length?searchOptions.join(""):`<div class="no-options">${noOptions}</div>`},selectOption:function(optionId,groupId){if(!this.hasGroups()){onSelect(this.getOptions()[optionId]);onClose()}else{Object.keys(groups).forEach((group,g)=>{this.getOptions().filter(option=>option.group==group).forEach((option,o)=>{if(group==groupId&&o==optionId){onSelect(option);onClose();return}})})}},mountOptions:function(){var self=this;const $options=$(`${selector} .search-options`);$options.html(this.renderSearchOptions());$(`${selector} .option`).on("click",function(e){const optionId=$(this).data("option");const groupId=$(this).data("group");self.selectOption(optionId,groupId)});const $focused=$(`${selector} .option.focused`);let offset;if(this.focusedOptionId>this.previousFocusedOptionId){offset=$focused.height()*($focused.index()+1);if(offset>$options.height())$options.scrollTop(offset-$options.height())}else if(this.focusedOptionId<this.previousFocusedOptionId){offset=$focused.height()*$focused.index();if(offset<$options.scrollTop())$options.scrollTop(offset)}},mount:function(){var self=this;$(selector).html(self.render());this.mountOptions();const el=document.querySelector(".search-options-widget");if(!el){return}const handleClose=()=>{onClose()};$(`${selector} input.search-for-options`).on("change input",function(e){self.search=$(this).val();self.focusedOptionId=false;self.previousFocusedOptionId=false;self.mountOptions()}).focus();if(el.getBoundingClientRect().y+$(el).height()>window.innerHeight){el.classList.add("mount-from-bottom")}$(`${selector} button.close`).on("click",function(e){handleClose()});const handleKeyDown=e=>{const{type:type,key:key,keyCode:keyCode}=e;switch(key){case"Esc":case"Escape":handleClose();break;case"Down":case"ArrowDown":e.preventDefault();if(this.focusedOptionId===this.getOptions().length-1){return}this.previousFocusedOptionId=this.focusedOptionId;this.focusedOptionId++;this.mountOptions();break;case"Up":case"ArrowUp":e.preventDefault();if(this.focusedOptionId===0){return}this.previousFocusedOptionId=this.focusedOptionId;this.focusedOptionId--;this.mountOptions();break;case"Enter":e.preventDefault();const $focused=$(`${selector} .option.focused`);this.selectOption($focused.data("option"),$focused.data("group"));break}};$(".search-options-widget").on("keydown",handleKeyDown);onOpen()}});const inputRepeaterWidget=({selector:selector="",rows:rows=[],cellProps:cellProps=[],cellCallbacks:cellCallbacks=[],onChange:onChange=rows=>{console.log(rows)}})=>({rows:rows,mount:function(){$(selector).html(this.render());this.onMount()},onMount:function(){$(`${selector} .remove-row`).on("click",e=>{const row=parseInt(e.currentTarget.dataset.row);this.rows.splice(row,1);onChange(this.rows);this.mount()});$(`${selector} #add-row`).on("click",e=>{this.rows.push(Array(cellProps.length).fill(""));onChange(this.rows);this.mount();$(`${selector} #add-row`).focus()});$(`${selector} input`).on("change",e=>{const row=parseInt(e.target.dataset.row);const cell=parseInt(e.target.dataset.cell);this.rows[row][cell]=e.target.value;onChange(this.rows)})},render:function(){const renderRow=(row,rowIndex)=>{return`
			<div class="gh-input-repeater-row">
				${row.map((cell,cellIndex)=>cellCallbacks[cellIndex]({...cellProps[cellIndex],value:cell,dataRow:rowIndex,dataCell:cellIndex})).join("")}
				<button class="dashicon-button remove-row" data-row="${rowIndex}"><span
					class="dashicons dashicons-no-alt"></span></button>
			</div>`};return`
		  <div class="gh-input-repeater">
			  ${this.rows.map((row,i)=>renderRow(row,i)).join("")}
			  <div class="gh-input-repeater-row-add">
				  <div class="spacer"></div>
				  <button id="add-row" class="dashicon-button">
					  <span class="dashicons dashicons-plus-alt2"></span></button>
			  </div>
		  </div>`}});const flattenObject=(obj,parent_key="")=>{if(typeof obj!=="object"){return{}}const flattened={};let key_prefix=parent_key?parent_key+".":"";for(const key in obj){if(obj.hasOwnProperty(key)){let value=obj[key];if(typeof value!=="object"){flattened[key_prefix+key]=value}else{Object.assign(flattened,flattenObject(value,key_prefix+key))}}}return flattened};function objectEquals(a,b){return JSON.stringify(a)===JSON.stringify(b)}const isValidEmail=email=>{const re=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return re.test(String(email).toLowerCase())};const primaryButton=({className:className,...props})=>{return button({className:"gh-button primary"+(className?" "+className:""),...props})};const secondaryButton=({className:className,...props})=>{return button({className:"gh-button secondary"+(className?" "+className:""),...props})};const dangerButton=({className:className,...props})=>{return button({className:"gh-button danger"+(className?" "+className:""),...props})};const button=({text:text="",className:className="",...props})=>{return`
		<button ${objectToProps({className:"gh-button"+(className?" "+className:""),...props})}>${text}</button>`};Groundhogg.element={...Elements,specialChars:specialChars,andList:andList,orList:orList,kebabize:kebabize,regexp:regexp,objectToProps:objectToProps,objectToStyle:objectToStyle,createOptions:createOptions,createSlotFillProvider:createSlotFillProvider,clickInsideElement:clickInsideElement,searchOptionsWidget:searchOptionsWidget,tinymceElement:tinymceElement,isValidEmail:isValidEmail,loadingModal:loadingModal,savingModal:savingModal,confirmationModal:confirmationModal,uuid:uuid,modal:modal,copyObject:copyObject,loadingDots:loadingDots,flattenObject:flattenObject,objectEquals:objectEquals,inputRepeaterWidget:inputRepeaterWidget,improveTinyMCE:improveTinyMCE,primaryButton:primaryButton,dangerButton:dangerButton,secondaryButton:secondaryButton,button:button,codeEditor:codeEditor}})(jQuery);