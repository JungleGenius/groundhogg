(function($){async function apiGet(route,params={},opts={}){const response=await fetch(route+"?"+$.param(params),{...opts,headers:{"X-WP-Nonce":Groundhogg.nonces._wprest}});return response.json()}async function apiPost(url="",data={},opts={}){const response=await fetch(url,{...opts,method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":Groundhogg.nonces._wprest},body:JSON.stringify(data)});return response.json()}async function apiPatch(url="",data={},opts={}){const response=await fetch(url,{...opts,method:"PATCH",headers:{"Content-Type":"application/json","X-WP-Nonce":Groundhogg.nonces._wprest},body:JSON.stringify(data)});return response.json()}async function apiDelete(url="",data={},opts={}){const response=await fetch(url,{...opts,method:"DELETE",headers:{"Content-Type":"application/json","X-WP-Nonce":Groundhogg.nonces._wprest},body:JSON.stringify(data)});return response.json()}const ObjectStore=(route,extra={})=>({primaryKey:"ID",getItemFromResponse:r=>r.item,getItemsFromResponse:r=>r.items,items:[],item:{},route:route,get:function(id){let item;if(this.item[this.primaryKey]===id){item=this.item}else{item=this.items.find(item=>item[this.primaryKey]===id)}return item},getItems:function(){return this.items},hasItem:function(id){return this.item[this.primaryKey]===id||this.items.find(item=>item[this.primaryKey]===id)},hasItems:function(itemIds){if(!itemIds){return this.items.length>0}for(let i=0;i<itemIds.length;i++){const itemId=itemIds[i];if(!this.items.find(item=>{return item[this.primaryKey]===itemId})){return false}}return true},fetchItems:async function(params){return apiGet(this.route,params).then(r=>this.getItemsFromResponse(r)).then(items=>{this.items=[...items,...this.items.filter(item=>!items.find(_item=>_item[this.primaryKey]===item[this.primaryKey]))];return items})},itemsFetched:function(items){this.items=[...items,...this.items.filter(item=>!items.find(_item=>_item[this.primaryKey]===item[this.primaryKey]))]},fetchItem:async function(id){return apiGet(`${this.route}/${id}`).then(r=>this.getItemFromResponse(r)).then(item=>{this.item=item;this.items=[item,...this.items.filter(item=>item[this.primaryKey]!==item[this.primaryKey])];return item})},post:async function(data){return apiPost(this.route,data).then(r=>this.getItemFromResponse(r)).then(item=>{this.items.push(item);return item})},patch:async function(id,data){return apiPatch(`${this.route}/${id}`,data).then(r=>this.getItemFromResponse(r)).then(item=>{this.item=item;this.items=[item,...this.items.filter(item=>item[this.primaryKey]!==item[this.primaryKey])];return item})},delete:async function(id){return apiDelete(`${this.route}/${id}`).then(r=>{if(this.item[this.primaryKey]===id){this.item={}}this.items=[...this.items.filter(item=>item[this.primaryKey]!==item[this.primaryKey])]})},...extra});Groundhogg.api.post=apiPost;Groundhogg.api.get=apiGet;Groundhogg.api.patch=apiPatch;Groundhogg.api.delete=apiDelete;Groundhogg.stores={tags:ObjectStore(Groundhogg.api.routes.v4.tags,{limit:100,offset:0,validate:async function(maybeTags){var self=this;return await apiPost(`${this.route}/validate`,maybeTags).then(r=>{if(!r.items){return[]}self.items=[...r.items,...self.items.filter(item=>!r.items.find(_item=>_item[this.primaryKey]===item[this.primaryKey]))];return r.items})},preloadTags:function(){var self=this;return apiGet(this.route,{limit:self.limit,offet:self.offset}).then(data=>{if(!data.items){return}Object.assign(self.items,data.items);if(data.items.length===self.limit){self.offset+=self.limit;self.preloadTags()}})}}),contacts:ObjectStore(Groundhogg.api.routes.v4.contacts),emails:ObjectStore(Groundhogg.api.routes.v4.emails)};Groundhogg.createStore=(id,route="",extra={})=>{const store=ObjectStore(route,extra);Groundhogg.stores[id]=store;return store}})(jQuery);