var wpghModal;(function($,defaults){wpghModal={overlay:null,window:null,content:null,title:null,source:null,frameUrl:"",args:{},init:function(title,href){this.args=this.getDefaults();this.parseArgs(href);this.overlay=$(".popup-overlay");this.window=$(".popup-window");this.content=$(".popup-content");this.title=$(".popup-title");this.loader=$(".iframe-loader-wrapper");var exp=/(https|http)?:\/\/((www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6})|(localhost)\b([-a-zA-Z0-9@:%_\+.~#?&\/=]*)/;var urlRegex=new RegExp(exp);this.sizeup();if(this.args.source.match(urlRegex)){this.loader.removeClass("hidden");this.source=$("<div><iframe class='hidden' src='"+this.args.source+"' width='"+this.args.width+"' height='"+(this.args.height-100)+"' onload='wpghModal.prepareFrame( this )'></iframe></div>")}else{this.source=$("#"+this.args.source)}this.title.text(title);if(typeof this.args.footer!=="undefined"&&this.args.footer==="false"){$(".popup-footer").addClass("hidden")}else{$(".popup-footer").removeClass("hidden")}if(typeof this.args.footertext!=="undefined"){$(".popup-save").text(this.args.footertext)}},parseArgs:function(queryArgs){var querystart=queryArgs.indexOf("#");var listArgs=queryArgs.substring(querystart+1);listArgs=listArgs.split("&");for(var i=0;i<listArgs.length;i++){var args=listArgs[i].split("=");this.args[args[0]]=decodeURIComponent(args[1].replace("+"," "))}return this.args},sizeup:function(){var w=Math.max(document.documentElement.clientWidth,window.innerWidth||0);var h=Math.max(document.documentElement.clientHeight,window.innerHeight||0);if(this.args.height>h){this.args.height=h-50}if(this.args.width>w){this.args.width=w-50}this.window.css("height",this.args.height+"px");this.window.css("width",this.args.width+"px");this.window.css("top","calc( 50% - "+this.args.height/2+"px )");this.window.css("left","calc( 50% - "+this.args.width/2+"px )");this.content.css("height",this.args.height-100+"px")},open:function(){this.pullContent();this.showPopUp();$(document).trigger("wpghModalOpened")},close:function(){this.pushContent();this.hidePopUp();if(this.args.preventSave===undefined){$(document).trigger("wpghModalClosed")}this.reset()},pullFrame:function(iframe){var $iframe=$(iframe);var $content=$("#wpbody-content",$iframe.contents());this.content.append($content)},prepareFrame:function(iframe){var $iframe=$(iframe);this.content.removeClass("hidden");this.content.css("padding",0);$iframe.removeClass("hidden");this.loader.addClass("hidden");$iframe.contents().find(".choose-template").click(function(){wpghModal.frameReload()})},frameReload:function(){this.content.addClass("hidden");this.loader.removeClass("hidden")},pullContent:function(){this.content.append(this.source.children());$(document).trigger("wpghModalContentPulled")},pushContent:function(){this.source.append(this.content.children());$(document).trigger("wpghModalContentPushed")},showPopUp:function(){this.overlay.removeClass("hidden");this.window.removeClass("hidden");this.overlay.fadeIn();this.window.fadeIn()},hidePopUp:function(){this.window.addClass("hidden");this.overlay.addClass("hidden")},getDefaults:function(){return JSON.parse(JSON.stringify(defaults))},reset:function(){this.args=this.getDefaults();this.content.css("padding","0 20px")},reload:function(){$(document).on("click",".trigger-popup",function(e){e.preventDefault();wpghModal.init(this.title,this.href);if($(this).hasClass("no-padding")){$(".popup-content").css("padding","0")}wpghModal.open()});$(document).on("click","#popup-close",function(){wpghModal.close()});$(document).on("click",".popup-save",function(){wpghModal.close();$(document).trigger("wpghModalSaved")})}};$(function(){wpghModal.reload();$(".wpgh-color").wpColorPicker()});$(document).on("wpghAddedStep",function(){$(".wpgh-color").wpColorPicker()})})(jQuery,wpghModalDefaults);