(function(){"use strict";if(!Element.prototype.matches){Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(s){var matches=(this.document||this.ownerDocument).querySelectorAll(s),i=matches.length;while(--i>=0&&matches.item(i)!==this){}return i>-1}}function clickInsideElement(e,selector){var el=e.srcElement||e.target;if(el&&el.matches(selector)){return el}else{while(el=el.parentNode){if(el.classList&&el.matches(selector)){return el}}}return false}function getPosition(e){console.log(e);const{clientX,clientY}=e;return{x:clientX,y:clientY}}const Templates={menu(className,items){return`
		  <div class="${className}-wrap">
			  <nav id="${className}" class="${className}">
				  <ul class="${className}__items">
					  ${items.map(item=>Templates.menuItem(className,item)).join("")}
				  </ul>
			  </nav>
		  </div>`},menuItem(className,item){return`
		  <li class="${className}__item">
			  <a class="${className}__link" data-key="${item.key}">${item.text}</a>
		  </li>`}};window.createContextMenu=({menuClassName:menuClassName="context-menu",targetSelector,items,onSelect:onSelect=function(){},onOpen:onOpen=function(){},onClose:onClose=function(){}})=>({menuClassName:menuClassName,targetSelector:targetSelector,items:items,onSelect:onSelect,onOpen:onOpen,onClose:onClose,contextMenuClassName:"context-menu",contextMenuItemClassName:"context-menu__item",contextMenuLinkClassName:"context-menu__link",contextMenuActive:"context-menu--active",targetInContext:false,clickCoords:0,clickCoordsX:0,clickCoordsY:0,menuState:0,menuWidth:0,menuHeight:0,menuPosition:0,menuPositionX:0,menuPositionY:0,windowWidth:0,windowHeight:0,menu:null,menuItems:null,init(){this.contextMenuClassName=this.menuClassName;this.contextMenuItemClassName=this.menuClassName+"__item";this.contextMenuLinkClassName=this.menuClassName+"__link";this.contextMenuActive=this.menuClassName+"--active";this.mount();this.contextListener();this.clickListener();this.scrollListener();this.keyupListener();this.resizeListener()},mount(){const wrapper=document.createElement("div");wrapper.innerHTML=Templates.menu(this.contextMenuClassName,this.items);document.querySelector("body").appendChild(wrapper);this.menu=document.querySelector(`#${this.contextMenuClassName}`)},contextListener(){var self=this;document.addEventListener("contextmenu",function(e){self.targetInContext=clickInsideElement(e,self.targetSelector);if(self.targetInContext){e.preventDefault();self.toggleMenuOn(e,self.targetInContext);self.positionMenu(e)}else{self.targetInContext=false;self.toggleMenuOff(e)}})},clickListener(){const self=this;document.addEventListener("click",function(e){const clickedElIsLink=clickInsideElement(e,`.${self.contextMenuLinkClassName}`);if(clickedElIsLink){e.preventDefault();self.menuItemListener(clickedElIsLink,e)}else{var button=e.which||e.button;if(button===1){self.toggleMenuOff(e)}}})},scrollListener(){const self=this;document.addEventListener("scroll",function(e){self.toggleMenuOff(e)})},keyupListener(){var self=this;window.onkeyup=function(e){if(e.keyCode===27){self.toggleMenuOff(e)}}},resizeListener(){var self=this;window.onresize=function(e){self.toggleMenuOff(e)}},toggleMenuOn(e,el){if(this.menuState!==1){this.menuState=1;this.menu.classList.add(this.contextMenuActive)}this.onOpen(e,el)},toggleMenuOff(e){if(this.menuState!==0){this.menuState=0;this.menu.classList.remove(this.contextMenuActive)}this.onClose(e)},positionMenu(e){this.clickCoords=getPosition(e);this.clickCoordsX=this.clickCoords.x;this.clickCoordsY=this.clickCoords.y;this.menuWidth=this.menu.offsetWidth+4;this.menuHeight=this.menu.offsetHeight+4;this.windowWidth=window.innerWidth;this.windowHeight=window.innerHeight;if(this.windowWidth-this.clickCoordsX<this.menuWidth){this.menu.style.left=this.windowWidth-this.menuWidth+"px"}else{this.menu.style.left=this.clickCoordsX+"px"}if(this.windowHeight-this.clickCoordsY<this.menuHeight){this.menu.style.top=this.windowHeight-this.menuHeight+"px"}else{this.menu.style.top=this.clickCoordsY+"px"}},menuItemListener(link,e){this.toggleMenuOff(e);console.log(link);this.onSelect(link.dataset.key)}})})();