{"version":3,"sources":["@wordpress/block-library/src/template-part/edit/index.js"],"names":["useRef","useEffect","useSelect","useDispatch","BlockControls","__experimentalUseBlockWrapperProps","useBlockWrapperProps","Dropdown","ToolbarGroup","ToolbarButton","Spinner","__","chevronUp","chevronDown","useTemplatePartPost","TemplatePartNamePanel","TemplatePartInnerBlocks","TemplatePartPlaceholder","TemplatePartSelection","TemplatePartEdit","attributes","_postId","postId","slug","theme","tagName","TagName","setAttributes","clientId","initialPostId","initialSlug","initialTheme","select","getBlocks","innerBlocks","editEntityRecord","blockChanges","current","undefined","status","blockWrapperProps","isTemplateFile","isPlaceholder","isUnresolvedTemplateFile","isOpen","onToggle","onClose","length"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useRef, useEffect } from '@wordpress/element';\nimport { useSelect, useDispatch } from '@wordpress/data';\nimport {\n\tBlockControls,\n\t__experimentalUseBlockWrapperProps as useBlockWrapperProps,\n} from '@wordpress/block-editor';\nimport {\n\tDropdown,\n\tToolbarGroup,\n\tToolbarButton,\n\tSpinner,\n} from '@wordpress/components';\nimport { __ } from '@wordpress/i18n';\nimport { chevronUp, chevronDown } from '@wordpress/icons';\n\n/**\n * Internal dependencies\n */\nimport useTemplatePartPost from './use-template-part-post';\nimport TemplatePartNamePanel from './name-panel';\nimport TemplatePartInnerBlocks from './inner-blocks';\nimport TemplatePartPlaceholder from './placeholder';\nimport TemplatePartSelection from './selection';\n\nexport default function TemplatePartEdit( {\n\tattributes: { postId: _postId, slug, theme, tagName: TagName = 'div' },\n\tsetAttributes,\n\tclientId,\n} ) {\n\tconst initialPostId = useRef( _postId );\n\tconst initialSlug = useRef( slug );\n\tconst initialTheme = useRef( theme );\n\n\t// Resolve the post ID if not set, and load its post.\n\tconst postId = useTemplatePartPost( _postId, slug, theme );\n\n\t// Set the post ID, once found, so that edits persist,\n\t// but wait until the third inner blocks change,\n\t// because the first 2 are just the template part\n\t// content loading.\n\tconst { innerBlocks } = useSelect(\n\t\t( select ) => {\n\t\t\tconst { getBlocks } = select( 'core/block-editor' );\n\t\t\treturn {\n\t\t\t\tinnerBlocks: getBlocks( clientId ),\n\t\t\t};\n\t\t},\n\t\t[ clientId ]\n\t);\n\tconst { editEntityRecord } = useDispatch( 'core' );\n\tconst blockChanges = useRef( 0 );\n\tuseEffect( () => {\n\t\tif ( blockChanges.current < 4 ) blockChanges.current++;\n\n\t\tif (\n\t\t\tblockChanges.current === 3 &&\n\t\t\t( initialPostId.current === undefined ||\n\t\t\t\tinitialPostId.current === null ) &&\n\t\t\tpostId !== undefined &&\n\t\t\tpostId !== null\n\t\t) {\n\t\t\tsetAttributes( { postId } );\n\t\t\teditEntityRecord( 'postType', 'wp_template_part', postId, {\n\t\t\t\tstatus: 'publish',\n\t\t\t} );\n\t\t}\n\t}, [ innerBlocks ] );\n\n\tconst blockWrapperProps = useBlockWrapperProps();\n\n\t// Part of a template file, post ID already resolved.\n\tconst isTemplateFile = !! postId;\n\t// Fresh new block.\n\tconst isPlaceholder =\n\t\t! postId && ! initialSlug.current && ! initialTheme.current;\n\t// Part of a template file, post ID not resolved yet.\n\tconst isUnresolvedTemplateFile = ! isPlaceholder && ! postId;\n\n\treturn (\n\t\t<TagName { ...blockWrapperProps }>\n\t\t\t{ isPlaceholder && (\n\t\t\t\t<TemplatePartPlaceholder setAttributes={ setAttributes } />\n\t\t\t) }\n\t\t\t{ isTemplateFile && (\n\t\t\t\t<BlockControls>\n\t\t\t\t\t<ToolbarGroup className=\"wp-block-template-part__block-control-group\">\n\t\t\t\t\t\t<TemplatePartNamePanel\n\t\t\t\t\t\t\tpostId={ postId }\n\t\t\t\t\t\t\tsetAttributes={ setAttributes }\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<Dropdown\n\t\t\t\t\t\t\tclassName=\"wp-block-template-part__preview-dropdown-button\"\n\t\t\t\t\t\t\tcontentClassName=\"wp-block-template-part__preview-dropdown-content\"\n\t\t\t\t\t\t\tposition=\"bottom right left\"\n\t\t\t\t\t\t\trenderToggle={ ( { isOpen, onToggle } ) => (\n\t\t\t\t\t\t\t\t<ToolbarButton\n\t\t\t\t\t\t\t\t\taria-expanded={ isOpen }\n\t\t\t\t\t\t\t\t\ticon={ isOpen ? chevronUp : chevronDown }\n\t\t\t\t\t\t\t\t\tlabel={ __( 'Choose another' ) }\n\t\t\t\t\t\t\t\t\tonClick={ onToggle }\n\t\t\t\t\t\t\t\t\t// Disable when open to prevent odd FireFox bug causing reopening.\n\t\t\t\t\t\t\t\t\t// As noted in https://github.com/WordPress/gutenberg/pull/24990#issuecomment-689094119 .\n\t\t\t\t\t\t\t\t\tdisabled={ isOpen }\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t\trenderContent={ ( { onClose } ) => (\n\t\t\t\t\t\t\t\t<TemplatePartSelection\n\t\t\t\t\t\t\t\t\tsetAttributes={ setAttributes }\n\t\t\t\t\t\t\t\t\tonClose={ onClose }\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t) }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</ToolbarGroup>\n\t\t\t\t</BlockControls>\n\t\t\t) }\n\t\t\t{ isTemplateFile && (\n\t\t\t\t<TemplatePartInnerBlocks\n\t\t\t\t\tpostId={ postId }\n\t\t\t\t\thasInnerBlocks={ innerBlocks.length > 0 }\n\t\t\t\t/>\n\t\t\t) }\n\t\t\t{ isUnresolvedTemplateFile && <Spinner /> }\n\t\t</TagName>\n\t);\n}\n"]}